FROM lunamidori5/pixelarch:quartz

RUN sudo sed -i 's/Quartz/Elroy/g' /etc/os-release

ARG USERNAME=midori-ai

USER $USERNAME
WORKDIR /home/$USERNAME/app

RUN yay -Syu --noconfirm uv && yay -Yccc --noconfirm

COPY . .
ENV ELROY_HOME=/home/$USERNAME/app/data

RUN uv venv --seed --python python3.11
RUN source .venv/bin/activate && uv pip install -e .

RUN mkdir -p /home/$USERNAME/app/data
RUN chmod -R 777 /home/$USERNAME/app/data

ENTRYPOINT ["source", ".venv/bin/activate", "&&", "elroy"]
CMD ["chat"]
